<!-- templates/calendar.html -->
<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kalend√°≈ô sch≈Øzek - Moravsk√© Weby</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
            color: #333;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }
        
        .header .nav {
            margin-top: 1rem;
        }
        
        .header .nav a {
            color: white;
            text-decoration: none;
            padding: 0.5rem 1rem;
            background: rgba(255,255,255,0.2);
            border-radius: 4px;
            display: inline-block;
            margin-right: 0.5rem;
        }
        
        .header .nav a:hover {
            background: rgba(255,255,255,0.3);
        }
        
        .container {
            max-width: 1400px;
            margin: 2rem auto;
            padding: 0 2rem;
        }
        
        .calendar-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding: 1rem;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .calendar-controls h2 {
            color: #667eea;
        }
        
        .btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            background: #667eea;
            color: white;
        }
        
        .btn:hover {
            background: #5568d3;
        }
        
        .calendar-grid {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            padding: 2rem;
        }
        
        .weekdays {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1rem;
            margin-bottom: 1rem;
            text-align: center;
            font-weight: bold;
            color: #667eea;
        }
        
        .days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1rem;
        }
        
        .day {
            aspect-ratio: 1;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 0.5rem;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            min-height: 100px;
        }
        
        .day:hover {
            border-color: #667eea;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.2);
        }
        
        .day.other-month {
            opacity: 0.3;
        }
        
        .day.today {
            border-color: #667eea;
            border-width: 2px;
            font-weight: bold;
        }
        
        .day-number {
            font-size: 1.2rem;
            margin-bottom: 0.5rem;
        }
        
        .day.has-meeting {
            background: #e8f4f8;
        }
        
        .day.has-block {
            background: #fff3cd;
        }
        
        .meeting-indicator {
            font-size: 0.8rem;
            padding: 0.25rem;
            background: #667eea;
            color: white;
            border-radius: 3px;
            margin-bottom: 0.25rem;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .block-indicator {
            font-size: 0.8rem;
            padding: 0.25rem;
            background: #ffc107;
            color: #333;
            border-radius: 3px;
            margin-bottom: 0.25rem;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .legend {
            display: flex;
            gap: 2rem;
            margin-top: 2rem;
            padding: 1rem;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }
        
        .legend-color.meeting {
            background: #e8f4f8;
            border: 1px solid #667eea;
        }
        
        .legend-color.block {
            background: #fff3cd;
            border: 1px solid #ffc107;
        }
        
        .legend-color.today {
            border: 2px solid #667eea;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üìÜ Kalend√°≈ô sch≈Øzek</h1>
        <div class="nav">
            <a href="/admin/meetings">‚Üê Zpƒõt na dashboard</a>
        </div>
    </div>
    
    <div class="container">
        <div class="calendar-controls">
            <button class="btn" onclick="previousMonth()">‚Üê P≈ôedchoz√≠</button>
            <h2 id="currentMonth">{{ current_month }}</h2>
            <button class="btn" onclick="nextMonth()">N√°sleduj√≠c√≠ ‚Üí</button>
        </div>
        
        <div class="calendar-grid">
            <div class="weekdays">
                <div>Po</div>
                <div>√öt</div>
                <div>St</div>
                <div>ƒåt</div>
                <div>P√°</div>
                <div>So</div>
                <div>Ne</div>
            </div>
            
            <div class="days" id="calendarDays">
                <!-- Days will be generated by JavaScript -->
            </div>
        </div>
        
        <div class="legend">
            <div class="legend-item">
                <div class="legend-color today"></div>
                <span>Dne≈°n√≠ den</span>
            </div>
            <div class="legend-item">
                <div class="legend-color meeting"></div>
                <span>Napl√°novan√° sch≈Øzka</span>
            </div>
            <div class="legend-item">
                <div class="legend-color block"></div>
                <span>Blokovan√Ω ƒças</span>
            </div>
        </div>
    </div>
    
    <script>
        // Data from server
        const meetings = {{ meetings | tojson }};
        const blocks = {{ blocks | tojson }};
        let currentDate = new Date('{{ current_month }}-01');
        
        function renderCalendar() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            
            // Update header
            const monthNames = ['Leden', '√önor', 'B≈ôezen', 'Duben', 'Kvƒõten', 'ƒåerven',
                              'ƒåervenec', 'Srpen', 'Z√°≈ô√≠', '≈ò√≠jen', 'Listopad', 'Prosinec'];
            document.getElementById('currentMonth').textContent = `${monthNames[month]} ${year}`;
            
            // First day of month and days in month
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const daysInMonth = lastDay.getDate();
            
            // Start from Monday (adjust if first day is not Monday)
            let startDay = firstDay.getDay() - 1;
            if (startDay < 0) startDay = 6;
            
            const daysContainer = document.getElementById('calendarDays');
            daysContainer.innerHTML = '';
            
            // Add empty cells for days before month starts
            for (let i = 0; i < startDay; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.className = 'day other-month';
                daysContainer.appendChild(emptyDay);
            }
            
            // Add days of the month
            const today = new Date();
            for (let day = 1; day <= daysInMonth; day++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'day';
                
                const currentDayDate = new Date(year, month, day);
                const dateStr = currentDayDate.toISOString().split('T')[0];
                
                // Check if today
                if (currentDayDate.toDateString() === today.toDateString()) {
                    dayElement.classList.add('today');
                }
                
                // Day number
                const dayNumber = document.createElement('div');
                dayNumber.className = 'day-number';
                dayNumber.textContent = day;
                dayElement.appendChild(dayNumber);
                
                // Check for meetings on this day
                const dayMeetings = meetings.filter(m => m.meeting_datetime.startsWith(dateStr));
                if (dayMeetings.length > 0) {
                    dayElement.classList.add('has-meeting');
                    dayMeetings.forEach(meeting => {
                        const indicator = document.createElement('div');
                        indicator.className = 'meeting-indicator';
                        const time = meeting.meeting_datetime.split('T')[1].substring(0, 5);
                        indicator.textContent = `${time} ${meeting.contact_name}`;
                        indicator.title = `${meeting.contact_name} - ${time}`;
                        dayElement.appendChild(indicator);
                    });
                }
                
                // Check for blocks on this day
                const dayBlocks = blocks.filter(b => b.date === dateStr);
                if (dayBlocks.length > 0) {
                    dayElement.classList.add('has-block');
                    dayBlocks.forEach(block => {
                        const indicator = document.createElement('div');
                        indicator.className = 'block-indicator';
                        indicator.textContent = `${block.time_from}-${block.time_to}`;
                        indicator.title = block.reason || 'Blokovan√Ω ƒças';
                        dayElement.appendChild(indicator);
                    });
                }
                
                daysContainer.appendChild(dayElement);
            }
        }
        
        function previousMonth() {
            currentDate.setMonth(currentDate.getMonth() - 1);
            // In production, reload with new month data
            window.location.href = `/admin/meetings/calendar?month=${currentDate.toISOString().substring(0, 7)}`;
        }
        
        function nextMonth() {
            currentDate.setMonth(currentDate.getMonth() + 1);
            // In production, reload with new month data
            window.location.href = `/admin/meetings/calendar?month=${currentDate.toISOString().substring(0, 7)}`;
        }
        
        // Initial render
        renderCalendar();
    </script>
</body>
</html>
